<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IndianTiers Premium</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        :root {
            --bg-body: #0b0e14;
            --bg-nav: #12161f;
            --bg-card: #161b26;
            --border: #232a3b;
            --accent: #ffb400;
            --rank1: #ffb400;
            --rank2: #94a3b8;
            --rank3: #cd7f32;
            --tier-gray: #4b5563;
            --retired-red: #ff4444;
            --tier1: #ffb400; --tier2: #94a3b8; --tier3: #cd7f32; --tier4: #4ade80; --tier5: #3b82f6;
            --current-mode-color: #ffb400;
        }

        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-body); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 9999;
        }
        .loader-spinner { width: 40px; height: 40px; border: 3px solid var(--border); border-top: 3px solid var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        body { font-family: 'Inter', sans-serif; background: var(--bg-body); color: white; margin: 0; padding-bottom: 50px; overflow-x: hidden; }
        
        .header-top { padding: 12px; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .nav-logo img { height: 80px; width: auto; border-radius: 8px; }
        .quick-links { display: flex; gap: 6px; width: 100%; max-width: 450px; justify-content: center; }
        .link-btn { background: #1c2230; border: 1px solid var(--border); padding: 10px; border-radius: 8px; text-decoration: none; font-size: 10px; font-weight: 700; flex: 1; display: flex; align-items: center; justify-content: center; gap: 5px; cursor: pointer; }
        
        .btn-ranking { color: #ffb400 !important; }
        .btn-discord { color: #3b82f6 !important; }
        .btn-admin { color: #ff4444 !important; }
        .link-btn img { width: 14px !important; height: 14px !important; }

        .navbar { background: var(--bg-nav); display: flex; gap: 12px; border-bottom: 1px solid var(--border); overflow-x: auto; position: sticky; top: 0; z-index: 100; padding: 12px 15px; scrollbar-width: none; scroll-behavior: smooth; -webkit-overflow-scrolling: touch; }
        .navbar::-webkit-scrollbar { display: none; }

        .nav-item { padding: 8px 18px; cursor: pointer; font-weight: 700; display: flex; align-items: center; gap: 8px; font-size: 12px; white-space: nowrap; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); color: #64748b; filter: grayscale(1); opacity: 0.6; border-radius: 25px; background: rgba(255,255,255,0.03); border: 1px solid transparent; }
        .nav-item img { width: 18px !important; height: 18px !important; transition: 0.3s; }
        
        .nav-item.active { 
            color: white !important; 
            background: var(--active-bg, rgba(255, 180, 0, 0.2)) !important; 
            border-color: var(--active-color, #ffb400) !important; 
            filter: grayscale(0); 
            opacity: 1; 
            transform: scale(1.1); 
            box-shadow: 0 4px 15px var(--active-shadow, rgba(255, 180, 0, 0.3)); 
        }

        .top-controls { padding: 15px; display: flex; justify-content: center; align-items: flex-end; gap: 12px; max-width: 600px; margin: 0 auto; }
        
        .filter-group { display: flex; flex-direction: column; gap: 4px; }
        .filter-label { font-size: 9px; font-weight: 900; color: var(--accent); letter-spacing: 1px; text-transform: uppercase; padding-left: 2px; }
        
        .region-filter {
            background: #1c2230;
            border: 2px solid var(--border);
            padding: 12px 15px;
            border-radius: 14px;
            font-size: 13px;
            font-weight: 800;
            outline: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23ffb400'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='3' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 14px;
            padding-right: 35px;
            min-width: 120px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
        }
        .region-filter:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3); }
        .region-filter option { background: #12161f; color: white; }

        .search-container { position: relative; display: flex; align-items: center; flex: 1; width: 100%; }
        .search-box { 
            background: var(--bg-card); border: 2px solid var(--border); padding: 14px 75px 14px 20px; border-radius: 14px; 
            color: white; flex: 1; outline: none; font-size: 15px; transition: 0.3s; width: 100%;
        }
        .search-box:focus { border-color: var(--current-mode-color) !important; box-shadow: 0 0 15px var(--current-mode-color); opacity: 0.8; }

        .search-btn {
            position: absolute; right: 8px; background: #2d3748; border: 1px solid var(--border); border-radius: 10px; 
            color: #a0aec0; padding: 8px 14px; cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: 0.3s ease; font-weight: 800; font-size: 10px; gap: 4px;
        }
        .search-btn.active-glow { background: var(--current-mode-color) !important; color: #000 !important; transform: scale(0.95); box-shadow: 0 0 15px var(--current-mode-color); }
        .search-btn img { width: 12px; height: 12px; filter: invert(0.7); transition: 0.3s; }
        .search-btn.active-glow img { filter: brightness(0) !important; }
        
        .list-container { max-width: 1100px; margin: 0 auto; display: none; flex-direction: column; gap: 15px; padding: 0 15px; }
        
        .player-row { background: var(--bg-card); border-radius: 14px; padding: 10px 15px; display: flex; align-items: center; border: 2px solid var(--border); cursor: pointer; position: relative; overflow: hidden; transition: 0.3s; }
        .player-row::after { content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%; transform: skewX(-20deg); animation: crownGlow 4s infinite; z-index: 0; pointer-events: none; }
        
        .row-rank-1::after { background: linear-gradient(90deg, transparent, rgba(255, 180, 0, 0.4), transparent); }
        .row-rank-2::after { background: linear-gradient(90deg, transparent, rgba(148, 163, 184, 0.35), transparent); }
        .row-rank-3::after { background: linear-gradient(90deg, transparent, rgba(205, 127, 50, 0.35), transparent); }
        .row-rank-other::after { background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.08), transparent); }

        @keyframes crownGlow { 0% { left: -100%; } 50% { left: 100%; } 100% { left: 100%; } }
        
        .row-rank-1 { border: 2.5px solid #ffb400 !important; background: linear-gradient(90deg, rgba(255, 180, 0, 0.3) 0%, rgba(255, 180, 0, 0.05) 50%, var(--bg-card) 100%) !important; animation: pulseGold 2.5s infinite ease-in-out; }
        .row-rank-2 { border: 2.5px solid #94a3b8 !important; background: linear-gradient(90deg, rgba(148, 163, 184, 0.25) 0%, rgba(148, 163, 184, 0.05) 50%, var(--bg-card) 100%) !important; animation: pulseSilver 2.5s infinite ease-in-out; }
        .row-rank-3 { border: 2.5px solid #cd7f32 !important; background: linear-gradient(90deg, rgba(205, 127, 50, 0.25) 0%, rgba(205, 127, 50, 0.05) 50%, var(--bg-card) 100%) !important; animation: pulseBronze 2.5s infinite ease-in-out; }
        .row-rank-other { border: 2px solid #2d3748 !important; background: linear-gradient(90deg, #000000 0%, #111827 40%, var(--bg-card) 100%) !important; animation: pulseGray 4s infinite ease-in-out; }

        @keyframes pulseGold { 0%, 100% { box-shadow: 0 0 10px rgba(255, 180, 0, 0.2); } 50% { box-shadow: 0 0 30px rgba(255, 180, 0, 0.6); } }
        @keyframes pulseSilver { 0%, 100% { box-shadow: 0 0 10px rgba(148, 163, 184, 0.15); } 50% { box-shadow: 0 0 25px rgba(148, 163, 184, 0.5); } }
        @keyframes pulseBronze { 0%, 100% { box-shadow: 0 0 10px rgba(205, 127, 50, 0.15); } 50% { box-shadow: 0 0 25px rgba(205, 127, 50, 0.5); } }
        @keyframes pulseGray { 0%, 100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.02); } 50% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.08); } }
        
        .rank-num-list { font-size: 42px; font-weight: 900; width: 60px; height: 50px; display: flex; align-items: center; justify-content: center; margin-right: 10px; font-style: italic; transform: skew(-5deg); z-index: 1; }
        .rank-num-1 { color: #ffb400; text-shadow: -4px 4px 0px #000; }
        .rank-num-2 { color: #94a3b8; text-shadow: -4px 4px 0px #000; }
        .rank-num-3 { color: #cd7f32; text-shadow: -4px 4px 0px #000; }
        .rank-num-other { color: #4b5563; font-size: 42px; text-shadow: -3px 3px 0px #000; }

        .player-img { width: 85px; height: 85px; border-radius: 2px; z-index: 1; filter: drop-shadow(-8px 2px 0px #000); transition: 0.3s; }
        .player-main { flex: 1; display: flex; flex-direction: column; gap: 3px; padding-left: 5px; z-index: 1; }
        .name-row { display: flex; align-items: center; gap: 12px; } 
        .player-name { font-weight: 800; font-size: 15px; color: #fff; line-height: 1.1; }
        .point-tag { display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; border-radius: 5px; font-size: 9px; font-weight: 800; text-transform: uppercase; background: rgba(255,255,255,0.05); color: #94a3b8; width: fit-content; }
        .point-tag img { width: 11px; height: 11px; object-fit: contain; }
        .points-row { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-top: 4px; }
        .points-val { font-weight: 900; font-size: 11px; letter-spacing: 0.5px; }
        .view-stats-text { font-size: 9px; font-weight: 900; letter-spacing: 1px; opacity: 0.8; margin-right: 5px; text-align: right; }

        .color-r1 { color: #ffb400 !important; } .color-r2 { color: #94a3b8 !important; } .color-r3 { color: #cd7f32 !important; } .color-ro { color: #64748b !important; }

        .grid-container { max-width: 1400px; margin: 0 auto; display: none; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; padding: 12px; }
        .grid-tier-box { background: var(--bg-card); border-radius: 14px; border: 1px solid var(--border); padding-bottom: 10px; height: fit-content; }
        .grid-tier-header { text-align: center; padding: 10px; font-weight: 800; font-size: 16px; border-bottom: 1px solid var(--border); text-transform: uppercase; margin-bottom: 8px; }
        .grid-player-card { padding: 8px; margin: 0 8px 6px 8px; background: rgba(255,255,255,0.03); border-radius: 8px; display: flex; align-items: center; gap: 8px; cursor: pointer; min-width: 0; }
        .grid-avatar { width: 20px; height: 20px; border-radius: 2px; }
        .grid-name { font-size: 10.5px; font-weight: 700; color: #fff; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1; }

        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.92); justify-content: center; align-items: center; padding: 10px; opacity: 0; transition: 0.3s; }
        .modal.show { display: flex; opacity: 1; }
        .modal-content { background: var(--bg-nav); padding: 35px 20px 25px 20px; border-radius: 28px; border: 1px solid var(--border); width: 100%; max-width: 350px; text-align: center; position: relative; max-height: 90vh; overflow-y: visible; box-sizing: border-box; transform: scale(0.9); transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .modal.show .modal-content { transform: scale(1); }
        .close-btn { position: absolute; right: 20px; top: 20px; color: #4b5563; cursor: pointer; font-size: 22px; z-index: 10; opacity: 0.7; }
        .modal-avatar { width: 85px; height: 85px; border-radius: 12px; border: 3px solid #1c2230; margin: 0 auto 15px auto; display: block; position: relative; z-index: 5; transition: 0.3s; }
        
        .modal.rank-1-glow .modal-avatar { border: 3px solid var(--rank1) !important; box-shadow: 0 0 15px var(--rank1); }
        .modal.rank-2-glow .modal-avatar { border: 3px solid var(--rank2) !important; box-shadow: 0 0 15px var(--rank2); }
        .modal.rank-3-glow .modal-avatar { border: 3px solid var(--rank3) !important; box-shadow: 0 0 15px var(--rank3); }

        .name-wrapper { display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 5px; }
        .m-namemc-icon img { width: 22px !important; height: 22px !important; border-radius: 4px; border: 1.5px solid #4b5563; }
        
        .tiers-box { background: rgba(255,255,255,0.01); border-radius: 18px; padding: 12px 5px; border: 1px solid var(--border); display: flex; flex-wrap: wrap; justify-content: center; gap: 12px 8px; position: relative; }
        .tier-item { position: relative; display: flex; flex-direction: column; align-items: center; gap: 3px; width: 42px; flex-shrink: 0; cursor: pointer; }
        
        /* Tooltip Style with Dynamic Border */
        .tier-item::after { 
            content: attr(data-pts); position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); 
            background: #1e2536; color: #ffffff; padding: 6px 10px; border-radius: 8px; font-size: 10px; font-weight: 800; 
            white-space: nowrap; border: 2px solid var(--hover-border, var(--accent)); 
            opacity: 0; pointer-events: none; transition: 0.2s ease; z-index: 10000; box-shadow: 0 5px 15px rgba(0,0,0,0.5); margin-bottom: 10px; 
        }
        .tier-item:hover::after { opacity: 1; bottom: 110%; }

        .pos-container { background: #0b0e14; border-radius: 14px; padding: 12px 18px; display: inline-flex; align-items: center; justify-content: center; margin: 20px auto; border: 1px solid var(--border); width: fit-content; max-width: 95%; box-sizing: border-box; }
        .pos-rank-num { font-weight: 900; font-size: 16px; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 8px; margin-right: 12px; color: white !important; flex-shrink: 0; border: 2px solid var(--border); transition: 0.3s; }
        
        .m-rank-1 { background: rgba(255, 180, 0, 0.2); border-color: #ffb400 !important; color: #ffb400 !important; box-shadow: 0 0 10px rgba(255, 180, 0, 0.3); }
        .m-rank-2 { background: rgba(148, 163, 184, 0.2); border-color: #94a3b8 !important; color: #94a3b8 !important; }
        .m-rank-3 { background: rgba(205, 127, 50, 0.2); border-color: #cd7f32 !important; color: #cd7f32 !important; }
        .m-rank-other { background: #1c2230; border-color: var(--border) !important; color: #64748b !important; }

        .pts-text-wrap { font-size: 11px; font-weight: 800; color: white; text-transform: uppercase; text-align: left; line-height: 1.2; }
        
        .section-title { font-size: 10px; font-weight: 900; color: #4b5563; text-align: left; margin-top: 15px; margin-bottom: 8px; letter-spacing: 1px; text-transform: uppercase; }
        .section-retired-title { color: var(--retired-red); }
        .icon-circle { width: 30px; height: 30px; background: #0b0e14; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); transition: 0.3s; }
        .tier-icon { width: 16px; height: 16px; object-fit: contain; }
        
        .tier-val { font-size: 8px; font-weight: 900; color: var(--accent); transition: 0.3s; }
        
        .is-unranked .tier-val, .is-retired-gray .tier-val { color: var(--tier-gray) !important; opacity: 0.6; }
        .is-unranked .tier-icon, .is-retired-gray .tier-icon { filter: grayscale(1); opacity: 0.3; }
        .is-unranked .icon-circle, .is-retired-gray .icon-circle { border-color: var(--border) !important; box-shadow: none !important; }

        .region-tag { padding: 1px 6px; border-radius: 4px; font-size: 9px; font-weight: 900; text-transform: uppercase; border: 1.5px solid transparent; flex-shrink: 0; }
        .reg-as { background: rgba(255, 173, 252, 0.1); color: #FFADFC; border-color: rgba(255, 173, 252, 0.4); }
        .reg-na { background: rgba(255, 68, 68, 0.1); color: #FF4444; border-color: rgba(255, 68, 68, 0.4); }
        .reg-au { background: rgba(0, 255, 255, 0.1); color: #00FFFF; border-color: rgba(0, 255, 255, 0.4); }
        .reg-eu { background: rgba(74, 222, 128, 0.1); color: #4ade80; border-color: rgba(74, 222, 128, 0.4); }

        #adminPanel { display: none; padding: 20px; flex-direction: column; gap: 8px; max-width: 400px; margin: 20px auto; text-align: center; border: 1px solid var(--border); border-radius: 15px; background: var(--bg-nav); }
        .admin-btn { background: #1c2230; border: 1px solid var(--border); color: white; padding: 12px; border-radius: 10px; font-weight: 700; cursor: pointer; transition: 0.2s; }
        
        .no-result { text-align: center; padding: 80px 20px; color: #64748b; font-weight: 700; font-size: 18px; width: 100%; display: flex; justify-content: center; align-items: center; }

        @media (min-width: 768px) {
            .player-name { font-size: 24px; }
            .player-row { padding: 18px 25px; }
            .grid-container { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)) !important; }
        }
    </style>
</head>
<body>

<div id="loader">
    <div class="loader-spinner"></div>
</div>

<div class="header-top">
    <div class="nav-logo"><img src="https://cdn.discordapp.com/attachments/1455267729614573795/1458775180477333545/1767869439071.png?ex=6962d801&is=69618681&hm=0b1546a32807615040af246e7bbe3da4f4a660f3475ad0fb144bce3adc6acd17&"></div>
    <div class="quick-links">
        <div class="link-btn btn-ranking" onclick="setMode('Overall', document.querySelector('.navbar .nav-item'))"><img src="https://www.centraltierlist.com/icons/trophy.svg"> Ranking</div>
        <a href="#" class="link-btn btn-discord"><img src="https://www.svgrepo.com/show/353655/discord-icon.svg"> Discord</a>
        <div class="link-btn btn-admin" onclick="unlockAdmin()"><img src="https://cdn-icons-png.flaticon.com/512/2206/2206368.png"> Admin Only</div>
    </div>
</div>

<div class="navbar" id="mode-nav">
    <div class="nav-item active" onclick="setMode('Overall', this)"><img src="https://www.centraltierlist.com/icons/trophy.svg"> Overall</div>
    <div class="nav-item" onclick="setMode('Vanilla', this)"><img src="https://mctiers.com/tier_icons/vanilla.svg"> Vanilla</div>
    <div class="nav-item" onclick="setMode('Pot', this)"><img src="https://mctiers.com/tier_icons/pot.svg"> Pot</div>
    <div class="nav-item" onclick="setMode('NethPot', this)"><img src="https://mctiers.com/tier_icons/nethop.svg"> NethPot</div>
    <div class="nav-item" onclick="setMode('Smp', this)"><img src="https://mctiers.com/tier_icons/smp.svg"> Smp</div>
    <div class="nav-item" onclick="setMode('Uhc', this)"><img src="https://mctiers.com/tier_icons/uhc.svg"> Uhc</div>
    <div class="nav-item" onclick="setMode('Sword', this)"><img src="https://mctiers.com/tier_icons/sword.svg"> Sword</div>
    <div class="nav-item" onclick="setMode('Axe', this)"><img src="https://mctiers.com/tier_icons/axe.svg"> Axe</div>
    <div class="nav-item" onclick="setMode('Mace', this)"><img src="https://mctiers.com/tier_icons/mace.svg"> Mace</div>
    <div class="nav-item" onclick="setMode('DiaSmp', this)"><img src="https://www.centraltierlist.com/icons/diasmp.svg"> DiaSmp</div>
</div>

<div class="top-controls">
    <div class="filter-group" id="regionFilterGroup">
        <div class="filter-label">REGION</div>
        <select class="region-filter" id="regionFilter" onchange="updateFilterColor(); render();">
            <option value="ALL">ALL</option>
            <option value="AS">ASIA</option>
            <option value="NA">NORTH AMERICA</option>
            <option value="EU">EUROPE</option>
            <option value="AU">AUSTRALIA</option>
        </select>
    </div>
    <div class="filter-group" style="flex: 1;">
        <div class="filter-label" style="color: #64748b;">SEARCH PLAYER</div>
        <div class="search-container">
            <input type="text" class="search-box" id="search" placeholder="Enter name..." oninput="render()" onkeydown="if(event.key === 'Enter') handleSearchClick()">
            <button class="search-btn" id="searchBtn" onclick="handleSearchClick()">
                <img src="https://www.svgrepo.com/show/532555/search.svg">
                ENTER
            </button>
        </div>
    </div>
</div>

<div id="view-overall" class="list-container"></div>
<div id="view-grid" class="grid-container"></div>

<div id="adminPanel">
    <h3 style="margin-top: 0; color: var(--accent);">Admin Dashboard</h3>
    <button class="admin-btn" onclick="addPlayer()">Update Database</button>
    <button class="admin-btn" style="color: #3b82f6;" onclick="retireGameMode()">Retirement (Gamemode)</button>
    <button class="admin-btn" style="color: #3b82f6;" onclick="unretireGameMode()">Remove Retirement</button>
    <button class="admin-btn" style="background:#2a1616; color:#ff4444;" onclick="removePlayer()">Remove Player</button>
</div>

<div id="playerModal" class="modal">
    <div class="modal-content">
        <span onclick="closeModal()" class="close-btn">&times;</span>
        <img id="m-img" class="modal-avatar" src="">
        <div class="name-wrapper">
            <div id="m-name" style="font-size: 22px; font-weight: 800; color: white;"></div>
            <a id="m-namemc-link" href="#" target="_blank" class="m-namemc-icon">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQsMp4jleWSjmpw00lLAJSXyEKSe-qCuqjWGVdCmnpKBw&s">
            </a>
        </div>
        <div id="m-point-tag" class="point-tag"></div>
        <div id="m-region-full" style="color: var(--retired-red); font-size: 11px; font-weight: 800; margin: 10px 0; text-transform: uppercase;"></div>
        <div class="pos-container">
            <div id="m-rank-num" class="pos-rank-num"></div>
            <div class="pts-text-wrap" id="m-pts-container">OVERALL <b id="m-pts-val" style="color:var(--accent);"></b> POINTS</div>
        </div>
        <div class="section-title">TIERS</div>
        <div class="tiers-box" id="m-active-stats"></div>
        <div class="section-title section-retired-title">RETIRED</div>
        <div class="tiers-box" id="m-retired-stats"></div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, getDocs, setDoc, doc, deleteDoc, updateDoc, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = { apiKey: "AIzaSyB3FmL5sS2UvJVkn5nzsocM05FWhnWd8t4", authDomain: "mansi-d5481.firebaseapp.com", projectId: "mansi-d5481", appId: "1:119988529319:web:f1aae38862c89ca0c31382" };
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const playersRef = collection(db, "players");

let players = [];
let currentMode = "Overall";
const gameModes = ["Vanilla", "Pot", "NethPot", "Smp", "Uhc", "Sword", "Axe", "Mace", "DiaSmp"];
const iconLinks = { Vanilla: "https://mctiers.com/tier_icons/vanilla.svg", Pot: "https://mctiers.com/tier_icons/pot.svg", NethPot: "https://mctiers.com/tier_icons/nethop.svg", Smp: "https://mctiers.com/tier_icons/smp.svg", Uhc: "https://mctiers.com/tier_icons/uhc.svg", Sword: "https://mctiers.com/tier_icons/sword.svg", Axe: "https://mctiers.com/tier_icons/axe.svg", Mace: "https://mctiers.com/tier_icons/mace.svg", DiaSmp: "https://www.centraltierlist.com/icons/diasmp.svg" };
const tierPoints = { "HT1": 60, "LT1": 45, "HT2": 30, "LT2": 20, "HT3": 10, "LT3": 6, "HT4": 4, "LT4": 3, "HT5": 2, "LT5": 1, "NONE": 0 };
const regionFullNames = { "AS": "ASIA", "NA": "NORTH AMERICA", "EU": "EUROPE", "AU": "AUSTRALIA" };

const modeColors = { 'Overall': '#ffb400', 'Vanilla': '#ff55ff', 'Pot': '#ff4444', 'NethPot': '#aa00aa', 'Smp': '#55ff55', 'Uhc': '#ff4444', 'Sword': '#55ffff', 'Axe': '#55ffff', 'Mace': '#aaaaaa', 'DiaSmp': '#55ffff' };

const ADMIN_KEY = "RAHULCOMBATGRANDMASTER";

const verifyAdmin = () => {
    const inputKey = prompt("Please enter Admin Key:");
    if (inputKey === ADMIN_KEY) return true;
    alert("Incorrect Key! Action Denied.");
    return false;
};

window.updateFilterColor = () => {
    const filter = document.getElementById("regionFilter");
    const val = filter.value;
    const colorMap = { 'ALL': '#ffb400', 'AS': '#FFADFC', 'NA': '#FF4444', 'EU': '#4ade80', 'AU': '#00FFFF' };
    filter.style.color = colorMap[val] || 'white';
};

window.addPlayer = async () => {
    if (!verifyAdmin()) return; 
    let name = prompt("Enter Player Minecraft Name:");
    if (!name) return;
    name = name.trim();
    const region = prompt("Enter Region (AS/NA/EU/AU):", "AS").toUpperCase();
    let updateData = { name: name, region: region, retiredModes: [] };
    for (const m of gameModes) {
        const tier = prompt(`Enter Tier for ${m} (e.g. HT1, LT2, NONE):`, "NONE").toUpperCase();
        updateData[m] = tier;
    }
    try {
        await setDoc(doc(db, "players", name), updateData, { merge: true });
        alert(`Success: ${name} has been updated!`);
        location.reload();
    } catch (e) { alert("Error updating database: " + e.message); }
};

window.retireGameMode = async () => {
    const name = prompt("Enter Player Name:");
    if (!name) return;
    const mode = prompt(`Enter Gamemode to retire (${gameModes.join('/')}):`);
    if (!gameModes.includes(mode)) { alert("Invalid Mode!"); return; }
    if (!verifyAdmin()) return; 
    try {
        await updateDoc(doc(db, "players", name), { retiredModes: arrayUnion(mode) });
        alert(`${mode} retired for ${name}!`);
        location.reload();
    } catch (e) { alert("Error: " + e.message); }
};

window.unretireGameMode = async () => {
    const name = prompt("Enter Player Name:");
    if (!name) return;
    const mode = prompt(`Enter Gamemode to restore (${gameModes.join('/')}):`);
    if (!verifyAdmin()) return; 
    try {
        await updateDoc(doc(db, "players", name), { retiredModes: arrayRemove(mode) });
        alert(`${mode} restored for ${name}!`);
        location.reload();
    } catch (e) { alert("Error: " + e.message); }
};

window.removePlayer = async () => {
    const name = prompt("Enter Player Name to DELETE:");
    if (!name) return;
    if (!verifyAdmin()) return; 
    if (confirm(`Are you sure you want to permanently delete ${name}?`)) {
        try {
            await deleteDoc(doc(db, "players", name));
            alert("Deleted successfully!");
            location.reload();
        } catch (e) { alert("Error: " + e.message); }
    }
};

window.unlockAdmin = () => { 
    if(prompt("Key:") === ADMIN_KEY) {
        document.getElementById("adminPanel").style.display = "flex";
        alert("Welcome, Rahul!");
        document.getElementById("adminPanel").scrollIntoView({ behavior: 'smooth' });
    } else { alert("Access Denied!"); }
}

async function loadData() {
    try {
        const snap = await getDocs(playersRef);
        players = snap.docs.map(d => {
            let data = d.data();
            data.total = gameModes.reduce((sum, m) => sum + (tierPoints[data[m]] || 0), 0);
            return data;
        });
        gsap.to("#loader", { opacity: 0, duration: 0.5, onComplete: () => { 
            document.getElementById("loader").style.display = "none"; 
            updateFilterColor();
            render(); 
        }});
    } catch(e) { console.error(e); }
}

window.setMode = (m, e) => { 
    currentMode = m; 
    const activeColor = modeColors[m] || '#ffb400';
    document.documentElement.style.setProperty('--current-mode-color', activeColor);
    const regFilterGroup = document.getElementById("regionFilterGroup");
    if(m === "Overall") regFilterGroup.style.display = "flex";
    else regFilterGroup.style.display = "none";
    document.querySelectorAll('.nav-item').forEach(i => { 
        i.classList.remove('active'); 
        i.style.removeProperty('--active-color'); 
        i.style.removeProperty('--active-bg'); 
        i.style.removeProperty('--active-shadow'); 
    }); 
    if(e) { 
        e.style.setProperty('--active-color', activeColor); 
        e.style.setProperty('--active-bg', activeColor + '33'); 
        e.style.setProperty('--active-shadow', activeColor + '4D'); 
        e.classList.add('active'); 
        e.scrollIntoView({ behavior: 'smooth', inline: 'center' }); 
    } 
    gsap.to(['#view-overall', '#view-grid'], { opacity: 0, y: 10, duration: 0.2, onComplete: () => { render(); gsap.to(['#view-overall', '#view-grid'], { opacity: 1, y: 0, duration: 0.4 }); }});
}

window.render = () => {
    const sortedActive = [...players].sort((a,b) => b.total - a.total);
    const searchVal = document.getElementById("search").value.toLowerCase();
    const regionVal = document.getElementById("regionFilter").value;
    const filtered = sortedActive.filter(p => {
        const matchesSearch = p.name.toLowerCase().includes(searchVal);
        const matchesRegion = currentMode !== "Overall" || regionVal === "ALL" || (p.region || "AS") === regionVal;
        return matchesSearch && matchesRegion;
    });
    const listCont = document.getElementById("view-overall");
    const gridCont = document.getElementById("view-grid");
    if(filtered.length === 0) {
        listCont.innerHTML = `<div class="no-result">No player found.</div>`;
        listCont.style.display = "flex"; gridCont.style.display = "none";
        return;
    }
    if(currentMode === "Overall") {
        listCont.style.display = "flex"; gridCont.style.display = "none";
        listCont.innerHTML = filtered.map(p => {
            const rank = sortedActive.findIndex(pl => pl.name === p.name) + 1;
            const tag = getPlayerTag(p.total);
            let rowCls = rank === 1 ? "row-rank-1" : rank === 2 ? "row-rank-2" : rank === 3 ? "row-rank-3" : "row-rank-other";
            let rankCls = rank === 1 ? "rank-num-1" : rank === 2 ? "rank-num-2" : rank === 3 ? "rank-num-3" : "rank-num-other";
            let colorCls = rank === 1 ? "color-r1" : rank === 2 ? "color-r2" : rank === 3 ? "color-r3" : "color-ro";
            const regCode = (p.region || 'AS').toUpperCase();
            const regClass = regCode === 'NA' ? 'reg-na' : regCode === 'AU' ? 'reg-au' : regCode === 'EU' ? 'reg-eu' : 'reg-as';
            return `<div class="player-row ${rowCls}" onclick="showStatus('${p.name}')">
                <div class="rank-num-list ${rankCls}">${rank}.</div>
                <img class="player-img" src="https://render.crafty.gg/3d/bust/${p.name}">
                <div class="player-main">
                    <div class="name-row">
                        <span class="region-tag ${regClass}">${regCode}</span>
                        <span class="player-name">${p.name}</span>
                    </div>
                    <span class="point-tag"><img src="${tag.icon}"> ${tag.text}</span>
                    <div class="points-row">
                        <span class="points-val ${colorCls}">POINTS: ${p.total}</span>
                        <span class="view-stats-text ${colorCls}">VIEW STATS</span>
                    </div>
                </div>
            </div>`;
        }).join('');
    } else {
        listCont.style.display = "none"; gridCont.style.display = "grid";
        gridCont.innerHTML = ["HT1", "LT1", "HT2", "LT2", "HT3", "LT3", "HT4", "LT4", "HT5", "LT5"].map(t => {
            const tierPlayers = filtered.filter(p => p[currentMode] === t && !(p.retiredModes && p.retiredModes.includes(currentMode)));
            if(tierPlayers.length === 0) return '';
            let tColor = t.includes("1") ? "var(--tier1)" : t.includes("2") ? "var(--tier2)" : t.includes("3") ? "var(--tier3)" : t.includes("4") ? "var(--tier4)" : "var(--tier5)";
            return `<div class="grid-tier-box"><div class="grid-tier-header" style="color:${tColor}">${t}</div>${tierPlayers.map(p => {
                const regCode = (p.region || 'AS').toUpperCase();
                const regClass = regCode === 'NA' ? 'reg-na' : regCode === 'AU' ? 'reg-au' : regCode === 'EU' ? 'reg-eu' : 'reg-as';
                return `<div class="grid-player-card" onclick="showStatus('${p.name}')"><span class="region-tag ${regClass}" style="font-size:7px; padding:1px 4px; margin-right:5px;">${regCode}</span><img src="https://mc-heads.net/avatar/${p.name}/24" class="grid-avatar"><div class="grid-name">${p.name}</div></div>`
            }).join('')}</div>`;
        }).join('');
    }
}

window.showStatus = (name) => {
    const p = players.find(pl => pl.name === name);
    const sorted = [...players].sort((a,b) => b.total - a.total);
    const rank = sorted.findIndex(pl => pl.name === name) + 1;
    const modal = document.getElementById("playerModal");
    modal.className = "modal"; 
    const rankEl = document.getElementById("m-rank-num");
    rankEl.className = "pos-rank-num";
    if(rank === 1) { modal.classList.add(`rank-1-glow`); rankEl.classList.add('m-rank-1'); }
    else if(rank === 2) { modal.classList.add(`rank-2-glow`); rankEl.classList.add('m-rank-2'); }
    else if(rank === 3) { modal.classList.add(`rank-3-glow`); rankEl.classList.add('m-rank-3'); }
    else { rankEl.classList.add('m-rank-other'); }
    rankEl.innerText = rank;
    document.getElementById("m-img").src = `https://mc-heads.net/avatar/${p.name}/100`;
    document.getElementById("m-name").innerText = p.name;
    document.getElementById("m-namemc-link").href = `https://namemc.com/search?q=${p.name}`;
    const regUpper = (p.region || 'AS').toUpperCase();
    document.getElementById("m-region-full").innerText = regionFullNames[regUpper] || regUpper;
    let mRegColor = '#FFADFC';
    if(regUpper === 'NA') mRegColor = '#FF4444';
    else if(regUpper === 'AU') mRegColor = '#00FFFF';
    else if(regUpper === 'EU') mRegColor = '#4ade80';
    document.getElementById("m-region-full").style.color = mRegColor;
    document.getElementById("m-pts-val").innerText = p.total;
    const tag = getPlayerTag(p.total);
    document.getElementById("m-point-tag").innerHTML = `<img src="${tag.icon}"> ${tag.text}`;
    
    // Tier Color Helper Function
    const getTierColor = (t) => {
        if(t.includes("1")) return "#ffb400";
        if(t.includes("2")) return "#94a3b8";
        if(t.includes("3")) return "#cd7f32";
        if(t.includes("4")) return "#4ade80";
        if(t.includes("5")) return "#3b82f6";
        return "#232a3b"; // Default border color
    };

    let activeHtml = ""; let retiredHtml = "";
    gameModes.forEach(m => {
        const t = p[m] || 'NONE';
        const pts = tierPoints[t] || 0;
        const isRetired = p.retiredModes && p.retiredModes.includes(m);
        const tColor = getTierColor(t);
        
        // Updated Circle and Text Style
        const circleStyle = t !== 'NONE' && !isRetired ? `border-color: ${tColor}; box-shadow: 0 0 8px ${tColor}4D;` : '';
        const textStyle = t !== 'NONE' && !isRetired ? `color: ${tColor};` : '';
        const hoverVar = t !== 'NONE' && !isRetired ? `--hover-border: ${tColor};` : '--hover-border: #ff4444;';

        const iconHtml = `<div class="icon-circle" style="${circleStyle}"><img src="${iconLinks[m]}" class="tier-icon"></div><div class="tier-val" style="${textStyle}">${t === 'NONE' ? '-' : t}</div>`;
        
        let hoverText = (t === 'NONE') ? `${m} | Unranked` : (isRetired) ? `${m} | Retired` : `${m} | ${pts} Points`;
        let tierItemClass = (t === 'NONE') ? 'is-unranked' : '';
        
        if(isRetired) {
            activeHtml += `<div class="tier-item is-retired-gray" style="--hover-border: #ff4444;" data-pts="${hoverText}">${iconHtml}</div>`;
            retiredHtml += `<div class="tier-item" style="--hover-border: #ff4444;" data-pts="${m} | ${pts} Point">${iconHtml}</div>`;
        } else {
            activeHtml += `<div class="tier-item ${tierItemClass}" style="${hoverVar}" data-pts="${hoverText}">${iconHtml}</div>`;
            retiredHtml += `<div class="tier-item is-unranked" style="--hover-border: #4b5563;" data-pts="${m} | Not Retired"><div class="icon-circle"><img src="${iconLinks[m]}" class="tier-icon"></div><div class="tier-val">-</div></div>`;
        }
    });
    document.getElementById("m-active-stats").innerHTML = activeHtml;
    document.getElementById("m-retired-stats").innerHTML = retiredHtml;
    modal.style.display = "flex"; setTimeout(() => modal.classList.add("show"), 10);
}

window.closeModal = () => { const m = document.getElementById("playerModal"); m.classList.remove("show"); setTimeout(() => m.style.display = "none", 300); }

window.handleSearchClick = () => {
    const btn = document.getElementById("searchBtn");
    btn.classList.add("active-glow");
    quickSearchOpen();
    setTimeout(() => { btn.classList.remove("active-glow"); }, 500);
};

window.quickSearchOpen = () => {
    const val = document.getElementById("search").value.trim().toLowerCase();
    const p = players.find(pl => pl.name.toLowerCase() === val);
    if(p) showStatus(p.name);
};

function getPlayerTag(pts) {
    if(pts >= 400) return { text: "Combat GrandMaster", icon: "https://mctiers.com/titles/combat_grandmaster.webp" };
    if(pts >= 250) return { text: "Combat Master", icon: "https://mctiers.com/titles/combat_master.webp" };
    if(pts >= 100) return { text: "Combat Ace", icon: "https://mctiers.com/titles/combat_ace.svg" };
    if(pts >= 50) return { text: "Combat Specialist", icon: "https://mctiers.com/titles/combat_specialist.svg" };
    if(pts >= 20) return { text: "Combat Cadet", icon: "https://mctiers.com/titles/combat_cadet.svg" };
    if(pts >= 10) return { text: "Combat Novice", icon: "https://mctiers.com/titles/combat_novice.svg" };
    return { text: "Rookie", icon: "https://mctiers.com/titles/rookie.svg" };
}

loadData();
</script>
</body>
</html>
